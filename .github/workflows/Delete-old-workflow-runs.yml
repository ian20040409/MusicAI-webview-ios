

name: Delete ALL workflow runs

on:
  workflow_dispatch:   # æ‰‹å‹•è§¸ç™¼

permissions:
  actions: write
  contents: read

jobs:
  delete-all:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      GH_REPO: ${{ github.repository }}
    steps:
      - name: Delete all workflow runs in this repository
        run: |
          echo "ğŸš¨ æ­£åœ¨åˆªé™¤ $GH_REPO ä¸­çš„æ‰€æœ‰ workflow runs..."
          while :; do
            ids=$(gh run list --repo "$GH_REPO" --limit 100 \
              --json databaseId \
              --jq '.[] | .databaseId')
            if [ -z "$ids" ]; then
              echo "âœ… æ²’æœ‰å¯åˆªé™¤çš„ runsï¼ŒçµæŸã€‚"
              break
            fi
            echo "ğŸ—‘ï¸ é€™æ‰¹ $(echo "$ids" | wc -l) ç­†å°‡è¢«åˆªé™¤..."
            for id in $ids; do
              gh run delete "$id" --repo "$GH_REPO"
            done
          done
          echo "ğŸ”¥ å…¨éƒ¨ workflow runs å·²åˆªé™¤å®Œæˆã€‚"
